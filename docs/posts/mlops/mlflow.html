<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sagar Thacker">
<meta name="dcterms.date" content="2023-05-28">
<meta name="description" content="Learn how MLflow simplifies experiment tracking, model versioning, and deployment for efficient machine learning development.">

<title>Sagar Thacker - Introduction to MLflow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-17YZDMEKH1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-17YZDMEKH1', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Sagar Thacker - Introduction to MLflow">
<meta name="twitter:description" content="Learn how MLflow simplifies experiment tracking, model versioning, and deployment for efficient machine learning development.">
<meta name="twitter:creator" content="@sagarthacker118">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sagar Thacker</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/sagar118"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/sagar-thacker/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:sagar+site@sagarthacker.com"><i class="bi bi-envelope" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Introduction to MLflow</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
                  <div>
        <div class="description">
          Learn how MLflow simplifies experiment tracking, model versioning, and deployment for efficient machine learning development.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">MLOps</div>
                <div class="quarto-category">MLflow</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sagar Thacker </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 28, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-experiment-tracking" id="toc-what-is-experiment-tracking" class="nav-link active" data-scroll-target="#what-is-experiment-tracking">What is Experiment Tracking?</a></li>
  <li><a href="#why-is-experiment-tracking-important" id="toc-why-is-experiment-tracking-important" class="nav-link" data-scroll-target="#why-is-experiment-tracking-important">Why is Experiment Tracking Important?</a></li>
  <li><a href="#getting-started-with-mlflow" id="toc-getting-started-with-mlflow" class="nav-link" data-scroll-target="#getting-started-with-mlflow">Getting Started with MLflow</a>
  <ul class="collapse">
  <li><a href="#install-mlflow-and-setup-environment" id="toc-install-mlflow-and-setup-environment" class="nav-link" data-scroll-target="#install-mlflow-and-setup-environment">Install MLflow and Setup Environment</a></li>
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset">Load Dataset</a></li>
  <li><a href="#prepare-and-transform-dataset" id="toc-prepare-and-transform-dataset" class="nav-link" data-scroll-target="#prepare-and-transform-dataset">Prepare and Transform Dataset</a></li>
  <li><a href="#train-linear-regression-model-with-mlflow" id="toc-train-linear-regression-model-with-mlflow" class="nav-link" data-scroll-target="#train-linear-regression-model-with-mlflow">Train Linear Regression Model with MLflow</a></li>
  <li><a href="#traing-a-lasso-regression-model" id="toc-traing-a-lasso-regression-model" class="nav-link" data-scroll-target="#traing-a-lasso-regression-model">Traing a Lasso Regression Model</a></li>
  </ul></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">Hyperparameter Tuning</a></li>
  <li><a href="#model-registry" id="toc-model-registry" class="nav-link" data-scroll-target="#model-registry">Model Registry</a></li>
  <li><a href="#mlflow-limitations" id="toc-mlflow-limitations" class="nav-link" data-scroll-target="#mlflow-limitations">MLflow Limitations</a></li>
  <li><a href="#alternatives-to-mlflow" id="toc-alternatives-to-mlflow" class="nav-link" data-scroll-target="#alternatives-to-mlflow">Alternatives to MLflow</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Welcome to our latest blog post, where we delve into the fascinating world of experiment tracking and its powerful implementation using MLflow. 📚 We’ll explore the concept of experiment tracking and learn how MLflow can revolutionize the way we track and manage our machine learning experiments.</p>
<p>In this comprehensive guide, we will walk you through the process of leveraging MLflow to effectively track your experiments, enabling you to gain valuable insights into model performance, parameter tuning, and results. Discover how MLflow’s model registry feature empowers you to version your models, ensuring reproducibility and seamless collaboration.</p>
<section id="what-is-experiment-tracking" class="level2">
<h2 class="anchored" data-anchor-id="what-is-experiment-tracking">What is Experiment Tracking?</h2>
<p>In a nutshell, it is the process of building an ML model. More formally, Experiment tracking is the process of keeping track of all the relevant information from an ML experiment, which includes:</p>
<ul>
<li>Source code</li>
<li>Environment</li>
<li>Data</li>
<li>Model</li>
<li>Hyperparameters</li>
<li>Metrics</li>
</ul>
<p>Terminologies associated with ML Experiments:</p>
<ol type="1">
<li><strong>Experiment Run</strong>: Each trail while building an ML model is called an experiment run. Whether it’s training a vanilla Linear Regression model or conducting hyperparameter tuning with various combinations, each distinct attempt is considered an experiment run. It allows for systematic organization and analysis of different approaches and variations.</li>
<li><strong>Run Artifact</strong>: Any file that is associated with an ML run is an Artifact. Example: Model weights, Model predictions, Model metrics, etc.</li>
<li><strong>Experiment Metadata</strong>: Additional information such as Model Signature - description of a model’s inputs and outputs, Model Input Example - example of a valid model input.</li>
</ol>
</section>
<section id="why-is-experiment-tracking-important" class="level2">
<h2 class="anchored" data-anchor-id="why-is-experiment-tracking-important">Why is Experiment Tracking Important?</h2>
<ul>
<li><strong>Reproducibility</strong>: It is important to be able to reproduce the results of an experiment. This is especially true in the case of ML experiments where the results are not deterministic. Experiment tracking helps us to reproduce the results of an experiment by keeping track of all the relevant information.</li>
<li><strong>Organization</strong>: Any file associated with an ML run is considered an artifact. These artifacts can include crucial components such as model weights, model predictions, model metrics, or any other files generated during the experiment. They serve as valuable resources for evaluating and understanding the outcomes of each run.</li>
<li><strong>Optimization</strong>: In addition to the core elements of an ML experiment, there is additional metadata that provides valuable context and insights. This metadata includes the model signature, which describes the inputs and outputs of the model, and the model input example, which provides an example of a valid input for the model. These details contribute to a comprehensive understanding of the experiment and aid in reproducibility.</li>
</ul>
<p>In the past, before the advent of dedicated experiment tracking tools, researchers and data scientists relied on spreadsheets to keep track of their experiments. However, this manual approach presented several challenges and limitations. Let’s explore the major points of concern:</p>
<ul>
<li><strong>Error Prone</strong>: The process of manually copying and pasting the results of an experiment from a Jupyter notebook or other sources into a spreadsheet was tedious and error-prone. It often led to mistakes or inaccuracies in recording the data, undermining the reliability and integrity of the experiment records.</li>
<li><strong>No standard format</strong>: Without a standardized format for organizing and documenting experiment results, researchers faced difficulties in comparing and analyzing the outcomes of different experiments. The lack of consistency hindered the ability to draw meaningful insights and make informed decisions based on the collected data.</li>
<li><strong>Visibility &amp; Collaboration</strong>: Sharing experiment results with other team members was a cumbersome task. Spreadsheet-based tracking offered limited visibility and collaboration capabilities, impeding effective teamwork and knowledge sharing. It was challenging to provide access, gather feedback, or collaborate on an experiment in a seamless manner.</li>
</ul>
</section>
<section id="getting-started-with-mlflow" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-mlflow">Getting Started with MLflow</h2>
<p>MLflow is an open-source platform for managing the end-to-end machine learning lifecycle. It provides a comprehensive set of tools for tracking experiments, packaging ML code, and deploying models. MLflow is designed to work with any ML library and language, and it is built on an open API, enabling seamless integration with other platforms and tools.</p>
<p>To see MLflow in action, let’s walk through a simple example of training a Linear Regression model on NY Green Taxi Trips dataset. We will use MLflow to track the experiment and record the results.</p>
<section id="install-mlflow-and-setup-environment" class="level3">
<h3 class="anchored" data-anchor-id="install-mlflow-and-setup-environment">Install MLflow and Setup Environment</h3>
<p>Create a new virtual environment and install MLflow and other libraries using the following command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">mlflow</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="ex">jupyter</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="ex">scikit-learn</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="ex">pandas</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="ex">xgboost</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="ex">fastparquet</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="ex">hyperopt</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="ex">optuna</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Create conda environment</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ex">conda</span> create <span class="at">-p</span> venv python=3.9 <span class="at">-y</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Activate conda environment</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="ex">conda</span> activate venv/</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># Install required libraries</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt <span class="at">--no-cache-dir</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Download the dataset using the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create data directory</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">mkdir</span> data</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Move to data directory</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="bu">cd</span> data</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Download dataset</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">wget</span> https://d37ci6vzurychx.cloudfront.net/trip-data/green_tripdata_2022-01.parquet <span class="co"># January 2022</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="fu">wget</span> https://d37ci6vzurychx.cloudfront.net/trip-data/green_tripdata_2022-02.parquet <span class="co"># February 2022</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="fu">wget</span> https://d37ci6vzurychx.cloudfront.net/trip-data/green_tripdata_2022-03.parquet <span class="co"># March 2022</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll also create a jupyter notebook named <code>mlflow.ipynb</code> to run our experiment. After following the above steps, you should have the following directory structure:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="bu">.</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="ex">├──</span> data</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="ex">│</span>   ├── green_tripdata_2022-01.parquet</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="ex">│</span>   ├── green_tripdata_2022-02.parquet</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="ex">│</span>   └── green_tripdata_2022-03.parquet</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="ex">├──</span> mlflow.ipynb</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="ex">├──</span> requirements.txt</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="ex">└──</span> venv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To see MLflow UI in action, we’ll run the following command while you’re in the root directory in the terminal:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">mlflow</span> ui</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will start the MLflow server on port 5000. You can access the MLflow UI at http://127.0.0.1:5000. Shown below:</p>
<p><img src="./images/mlflow_ui.png" class="img-fluid"></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you face an <strong>Access to 127.0.0.1 was denied. You don’t have authorization to view this page. HTTP ERROR 403</strong> error while accessing the MLflow UI, you can resolve it by clearing the browser cache and cookies.</p>
</div>
</div>
<p>One interesting thing to note here is that MLflow will create a new directory named <code>mlruns</code> in the current working directory. This directory will contain all the experiment runs and artifacts. This configuration of backend and artifact storage is called <code>MLflow on localhost</code>. There are other configurations available as well, which we will explore in another post.</p>
<p align="center">
<img src="https://mlflow.org/docs/latest/_images/scenario_1.png" width="400" height="450/">
</p><p>
Source: <a href="https://mlflow.org/docs/latest/tracking.html#scenario-1-mlflow-on-localhost">MLflow Documentation</a>
</p>
<p></p>
</section>
<section id="load-dataset" class="level3">
<h3 class="anchored" data-anchor-id="load-dataset">Load Dataset</h3>
<p>Let’s start by importing the required libraries and loading the dataset.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">import</span> os</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="im">import</span> pickle</span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="im">import</span> mlflow</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="im">import</span> optuna</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="im">from</span> mlflow.entities <span class="im">import</span> ViewType</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="im">from</span> mlflow.tracking <span class="im">import</span> MlflowClient</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="im">from</span> optuna.samplers <span class="im">import</span> TPESampler</span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="im">from</span> sklearn.feature_extraction <span class="im">import</span> DictVectorizer</span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, Lasso</span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">def</span> read_dataframe(filename: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">    Reads a Parquet file into a pandas DataFrame, performs data transformations, and returns the resulting DataFrame.</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">    Parameters:</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">        filename (str): The path to the Parquet file to be read.</span></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">    Returns:</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">        pandas.DataFrame: The processed DataFrame containing the data from the Parquet file.</span></span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">    Raises:</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">        [Any exceptions raised by pandas.read_parquet()]</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">    Notes:</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">        - The function performs the following transformations on the DataFrame:</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">            - Converts 'lpep_dropoff_datetime' and 'lpep_pickup_datetime' columns to pandas datetime objects.</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">            - Computes the 'duration' column by subtracting 'lpep_pickup_datetime' from 'lpep_dropoff_datetime'</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">              and converting the result to minutes.</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">            - Filters the DataFrame to include rows where the 'duration' is between 1 and 60 minutes (inclusive).</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">            - Converts 'PULocationID' and 'DOLocationID' columns to string type.</span></span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">    Example:</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">        filename = 'data.parquet'</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">        df = read_dataframe(filename)</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">    """</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>    <span class="co"># Read the Parquet file into a DataFrame</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>    df <span class="op">=</span> pd.read_parquet(filename)</span>
<span id="cb7-28"><a href="#cb7-28"></a></span>
<span id="cb7-29"><a href="#cb7-29"></a>    <span class="co"># Convert 'lpep_dropoff_datetime' and 'lpep_pickup_datetime' columns to pandas datetime objects</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>    df.lpep_dropoff_datetime <span class="op">=</span> pd.to_datetime(df.lpep_dropoff_datetime)</span>
<span id="cb7-31"><a href="#cb7-31"></a>    df.lpep_pickup_datetime <span class="op">=</span> pd.to_datetime(df.lpep_pickup_datetime)</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a>    <span class="co"># Compute the 'duration' column by subtracting 'lpep_pickup_datetime' from 'lpep_dropoff_datetime' and converting to minutes</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>    df[<span class="st">'duration'</span>] <span class="op">=</span> df.lpep_dropoff_datetime <span class="op">-</span> df.lpep_pickup_datetime</span>
<span id="cb7-35"><a href="#cb7-35"></a>    df.duration <span class="op">=</span> df.duration.<span class="bu">apply</span>(<span class="kw">lambda</span> td: td.total_seconds() <span class="op">/</span> <span class="dv">60</span>)</span>
<span id="cb7-36"><a href="#cb7-36"></a></span>
<span id="cb7-37"><a href="#cb7-37"></a>    <span class="co"># Filter the DataFrame to include rows where the 'duration' is between 1 and 60 minutes (inclusive)</span></span>
<span id="cb7-38"><a href="#cb7-38"></a>    df <span class="op">=</span> df[(df.duration <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df.duration <span class="op">&lt;=</span> <span class="dv">60</span>)]</span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a>    <span class="co"># Convert 'PULocationID' and 'DOLocationID' columns to string type</span></span>
<span id="cb7-41"><a href="#cb7-41"></a>    categorical <span class="op">=</span> [<span class="st">'PULocationID'</span>, <span class="st">'DOLocationID'</span>]</span>
<span id="cb7-42"><a href="#cb7-42"></a>    df[categorical] <span class="op">=</span> df[categorical].astype(<span class="bu">str</span>)</span>
<span id="cb7-43"><a href="#cb7-43"></a>    </span>
<span id="cb7-44"><a href="#cb7-44"></a>    <span class="co"># Return the processed DataFrame</span></span>
<span id="cb7-45"><a href="#cb7-45"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Read the Parquet file for training data into a DataFrame</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>df_train <span class="op">=</span> read_dataframe(<span class="st">'./data/green_tripdata_2022-01.parquet'</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Read the Parquet file for validation data into a DataFrame</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>df_val <span class="op">=</span> read_dataframe(<span class="st">'./data/green_tripdata_2022-02.parquet'</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># Read the Parquet file for testing data into a DataFrame</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>df_test <span class="op">=</span> read_dataframe(<span class="st">'./data/green_tripdata_2022-03.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prepare-and-transform-dataset" class="level3">
<h3 class="anchored" data-anchor-id="prepare-and-transform-dataset">Prepare and Transform Dataset</h3>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">def</span> preprocess(df: pd.DataFrame, dv: DictVectorizer, fit_dv: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">    Preprocesses a pandas DataFrame by creating new features, transforming categorical features into a numerical format,</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">    and returning the transformed data along with the DictVectorizer.</span></span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">    Parameters:</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">        df (pandas.DataFrame): The input DataFrame to be preprocessed.</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">        dv (sklearn.feature_extraction.DictVectorizer): The DictVectorizer instance to be used for transforming categorical features.</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">        fit_dv (bool, optional): Indicates whether to fit the DictVectorizer on the data. Defaults to False.</span></span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">    Returns:</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">        tuple: A tuple containing the transformed feature matrix and the DictVectorizer instance.</span></span>
<span id="cb9-13"><a href="#cb9-13"></a></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">    Notes:</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">        - The function assumes that the DataFrame contains the columns 'PULocationID' and 'DOLocationID'.</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">        - The function creates a new feature 'PU_DO' by concatenating 'PULocationID' and 'DOLocationID'.</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">        - The categorical feature 'PU_DO' and numerical feature 'trip_distance' are selected for transformation.</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">        - The function transforms the selected features into a dictionary representation and applies the DictVectorizer.</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">        - If fit_dv is True, the DictVectorizer is fitted on the data. Otherwise, the existing fitted DictVectorizer is used.</span></span>
<span id="cb9-20"><a href="#cb9-20"></a></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">    Example:</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">        df = read_dataframe('data.parquet')</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">        dv = DictVectorizer()</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">        X, dv = preprocess(df, dv, fit_dv=True)</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">    """</span></span>
<span id="cb9-26"><a href="#cb9-26"></a>    <span class="co"># Create a new feature 'PU_DO' by concatenating 'PULocationID' and 'DOLocationID'</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>    df[<span class="st">'PU_DO'</span>] <span class="op">=</span> df[<span class="st">'PULocationID'</span>] <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> df[<span class="st">'DOLocationID'</span>]</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a>    <span class="co"># Select categorical and numerical features for transformation</span></span>
<span id="cb9-30"><a href="#cb9-30"></a>    categorical <span class="op">=</span> [<span class="st">'PU_DO'</span>]</span>
<span id="cb9-31"><a href="#cb9-31"></a>    numerical <span class="op">=</span> [<span class="st">'trip_distance'</span>]</span>
<span id="cb9-32"><a href="#cb9-32"></a></span>
<span id="cb9-33"><a href="#cb9-33"></a>    <span class="co"># Convert the selected features into a dictionary representation</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>    dicts <span class="op">=</span> df[categorical <span class="op">+</span> numerical].to_dict(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb9-35"><a href="#cb9-35"></a></span>
<span id="cb9-36"><a href="#cb9-36"></a>    <span class="co"># Apply DictVectorizer for transforming categorical features</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>    <span class="cf">if</span> fit_dv:</span>
<span id="cb9-38"><a href="#cb9-38"></a>        <span class="co"># Fit the DictVectorizer on the data</span></span>
<span id="cb9-39"><a href="#cb9-39"></a>        X <span class="op">=</span> dv.fit_transform(dicts)</span>
<span id="cb9-40"><a href="#cb9-40"></a>    <span class="cf">else</span>:</span>
<span id="cb9-41"><a href="#cb9-41"></a>        <span class="co"># Transform using the existing fitted DictVectorizer</span></span>
<span id="cb9-42"><a href="#cb9-42"></a>        X <span class="op">=</span> dv.transform(dicts)</span>
<span id="cb9-43"><a href="#cb9-43"></a></span>
<span id="cb9-44"><a href="#cb9-44"></a>    <span class="co"># Return the transformed feature matrix and DictVectorizer</span></span>
<span id="cb9-45"><a href="#cb9-45"></a>    <span class="cf">return</span> X, dv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Extract the target variable</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>target <span class="op">=</span> <span class="st">'duration'</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># Extract the target variable from the training, validation and testing datasets</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>y_train <span class="op">=</span> df_train[target].values</span>
<span id="cb10-6"><a href="#cb10-6"></a>y_val <span class="op">=</span> df_val[target].values</span>
<span id="cb10-7"><a href="#cb10-7"></a>y_test <span class="op">=</span> df_test[target].values</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co"># Initialize a DictVectorizer for preprocessing</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>dv <span class="op">=</span> DictVectorizer()</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co"># Preprocess the training data</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>X_train, dv <span class="op">=</span> preprocess(df_train, dv, fit_dv<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co"># Preprocess the validation data using the fitted DictVectorizer from the training data</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>X_val, _ <span class="op">=</span> preprocess(df_val, dv, fit_dv<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co"># Preprocess the testing data using the fitted DictVectorizer from the training data</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>X_test, _ <span class="op">=</span> preprocess(df_test, dv, fit_dv<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">def</span> dump_pickle(obj, filename: <span class="bu">str</span>):</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">    Pickles (serializes) an object and saves it to a file.</span></span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">    Parameters:</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">        obj (Any): The object to be pickled.</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">        filename (str): The path and filename to save the pickled object.</span></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">    Returns:</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">        None</span></span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">    Notes:</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">        - The function uses the 'pickle' module to serialize the object and save it to a file.</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">        - The file is opened in binary mode for writing using the "wb" mode.</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">    """</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">"wb"</span>) <span class="im">as</span> f_out:</span>
<span id="cb11-17"><a href="#cb11-17"></a>        <span class="cf">return</span> pickle.dump(obj, f_out)</span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co"># Specify the destination path for saving files</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>dest_path <span class="op">=</span> <span class="st">'./outputs'</span></span>
<span id="cb11-22"><a href="#cb11-22"></a></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co"># Create dest_path folder unless it already exists</span></span>
<span id="cb11-24"><a href="#cb11-24"></a>os.makedirs(dest_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-25"><a href="#cb11-25"></a></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co"># Save DictVectorizer object as a pickle file</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>dump_pickle(dv, os.path.join(dest_path, <span class="st">"dv.pkl"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-linear-regression-model-with-mlflow" class="level3">
<h3 class="anchored" data-anchor-id="train-linear-regression-model-with-mlflow">Train Linear Regression Model with MLflow</h3>
<p>In mlflow you create one experiment and all the runs are stored under that experiment. You can create a new experiment using the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Create a new experiment</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>mlflow.set_experiment(<span class="st">"nyc-taxi-experiment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you check your MLflow UI, you’ll notice a new experiment named <code>ny-taxi-experiment</code> has been created under Experiments section. All the runs and artifacts will be stored under this experiment.</p>
<p><img src="./images/mlflow_new_exp.png" class="img-fluid"></p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Specify the destination path for saving model files</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>model_path <span class="op">=</span> <span class="st">"./outputs/models"</span></span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># Start an MLflow run</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="cf">with</span> mlflow.start_run():</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="co"># Set a tag for the developer</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    mlflow.set_tag(<span class="st">"developer"</span>, <span class="st">"Sagar"</span>)</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="co"># Initialize and train a LinearRegression model</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    lr <span class="op">=</span> LinearRegression()</span>
<span id="cb13-11"><a href="#cb13-11"></a>    lr.fit(X_train, y_train)</span>
<span id="cb13-12"><a href="#cb13-12"></a></span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="co"># Make predictions on the validation data</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>    yhat <span class="op">=</span> lr.predict(X_val)</span>
<span id="cb13-15"><a href="#cb13-15"></a></span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="co"># Calculate the root mean squared error (RMSE)</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>    rmse <span class="op">=</span> mean_squared_error(y_val, yhat, squared<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-18"><a href="#cb13-18"></a></span>
<span id="cb13-19"><a href="#cb13-19"></a>    <span class="co"># Log the RMSE metric to MLflow</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>    mlflow.log_metric(<span class="st">"rmse"</span>, rmse)</span>
<span id="cb13-21"><a href="#cb13-21"></a></span>
<span id="cb13-22"><a href="#cb13-22"></a>    <span class="co"># Create dest_path folder unless it already exists</span></span>
<span id="cb13-23"><a href="#cb13-23"></a>    os.makedirs(model_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-24"><a href="#cb13-24"></a></span>
<span id="cb13-25"><a href="#cb13-25"></a>    <span class="co"># Save the trained model as a pickle file</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>    dump_pickle(lr, os.path.join(model_path, <span class="st">"lin_reg.pkl"</span>))</span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-28"><a href="#cb13-28"></a>    <span class="co"># Log the trained model as an artifact to MLflow</span></span>
<span id="cb13-29"><a href="#cb13-29"></a>    mlflow.log_artifact(local_path<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>model_path<span class="sc">}</span><span class="ss">/lin_reg.pkl"</span>, artifact_path<span class="op">=</span><span class="st">"models_pickle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running an experiment run, go to your MLflow UI and there you can see an entry of the run. If you click on the run you have observer other details associated with the run such as <code>Metrics</code>, <code>Tags</code>, <code>Artifacts</code>. In the <code>Artifacts</code> section you can see the <code>model_pickle</code> folder which contains the model file. You can download the model file from there and use it for prediction.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you don’t see your run on the UI, you can refresh using <code>Refresh</code> button on the right side of the page above the table.</p>
</div>
</div>
<p><img src="./images/linear_reg.png" class="img-fluid"></p>
<p><img src="./images/lr_exp.png" class="img-fluid"></p>
<p>Voila 🎉! You have successfully trained a Linear Regression model and tracked the experiment using MLflow. You can find the complete code.</p>
</section>
<section id="traing-a-lasso-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="traing-a-lasso-regression-model">Traing a Lasso Regression Model</h3>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Specify the destination path for saving model files</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>model_path <span class="op">=</span> <span class="st">"./outputs/models"</span></span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># Start an MLflow run</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="cf">with</span> mlflow.start_run():</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="co"># Set a tag for the developer</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    mlflow.set_tag(<span class="st">"developer"</span>, <span class="st">"Sagar"</span>)</span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="co"># Set the value for the regularization parameter (alpha)</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>    alpha <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb14-11"><a href="#cb14-11"></a></span>
<span id="cb14-12"><a href="#cb14-12"></a>    <span class="co"># Log the regularization parameter (alpha) as a parameter in MLflow</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>    mlflow.log_param(<span class="st">"alpha"</span>, alpha)</span>
<span id="cb14-14"><a href="#cb14-14"></a></span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="co"># Initialize and train a Lasso Regression model</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>    lasso <span class="op">=</span> Lasso(alpha<span class="op">=</span>alpha)</span>
<span id="cb14-17"><a href="#cb14-17"></a>    lasso.fit(X_train, y_train)</span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a>    <span class="co"># Make predictions on the validation data</span></span>
<span id="cb14-20"><a href="#cb14-20"></a>    yhat <span class="op">=</span> lasso.predict(X_val)</span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-22"><a href="#cb14-22"></a>    <span class="co"># Calculate the root mean squared error (RMSE)</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>    rmse <span class="op">=</span> mean_squared_error(y_val, yhat, squared<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-24"><a href="#cb14-24"></a></span>
<span id="cb14-25"><a href="#cb14-25"></a>    <span class="co"># Log the RMSE metric to MLflow</span></span>
<span id="cb14-26"><a href="#cb14-26"></a>    mlflow.log_metric(<span class="st">"rmse"</span>, rmse)</span>
<span id="cb14-27"><a href="#cb14-27"></a></span>
<span id="cb14-28"><a href="#cb14-28"></a>    <span class="co"># Create the destination folder for saving model files if it doesn't exist</span></span>
<span id="cb14-29"><a href="#cb14-29"></a>    os.makedirs(model_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-30"><a href="#cb14-30"></a></span>
<span id="cb14-31"><a href="#cb14-31"></a>    <span class="co"># Save the trained Lasso Regression model as a pickle file</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>    dump_pickle(lr, os.path.join(model_path, <span class="st">"lasso_reg.pkl"</span>))</span>
<span id="cb14-33"><a href="#cb14-33"></a></span>
<span id="cb14-34"><a href="#cb14-34"></a>    <span class="co"># Log the trained model as an artifact to MLflow</span></span>
<span id="cb14-35"><a href="#cb14-35"></a>    mlflow.log_artifact(local_path<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>model_path<span class="sc">}</span><span class="ss">/lasso_reg.pkl"</span>, artifact_path<span class="op">=</span><span class="st">"models_pickle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to Linear Regression, we can train a Lasso Regression model and track the experiment using MLflow.</p>
</section>
</section>
<section id="hyperparameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameter-tuning">Hyperparameter Tuning</h2>
<p>Tools such as MLflow shine when it comes to hyperparameter tuning and model selection. Let’s see how we can leverage MLflow to tune the hyperparameters of our model.</p>
<p>We’ll setup a new experiment for hyperparameter tuning and use MLflow to track the results. We’ll use <code>Hyperopt</code> and <code>Optuna</code> libraries for hyperparameter tuning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create a new experiment</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>mlflow.set_experiment(<span class="st">"random-forest-hyperopt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">def</span> run_optimization(num_trials: <span class="bu">int</span> <span class="op">=</span> <span class="dv">10</span>):</span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">    Runs the optimization process using Optuna library to find the optimal hyperparameters for RandomForestRegressor.</span></span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">    Parameters:</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">        num_trials (int): The number of optimization trials to perform. Default is 10.</span></span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">    Returns:</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">        None</span></span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">    Notes:</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">        - The function defines an objective function for Optuna to minimize the root mean squared error (RMSE).</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">        - The objective function samples hyperparameters, trains a RandomForestRegressor model with those hyperparameters,</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">          evaluates the model on the validation data, and logs the RMSE metric to MLflow.</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">        - Optuna performs the optimization process by searching for the set of hyperparameters that minimizes the RMSE.</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co">    """</span></span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a>    <span class="kw">def</span> objective(trial):</span>
<span id="cb16-19"><a href="#cb16-19"></a>        <span class="co">"""</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="co">        Objective function for Optuna optimization.</span></span>
<span id="cb16-21"><a href="#cb16-21"></a></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co">        Parameters:</span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="co">            trial (optuna.Trial): A trial object representing a single optimization trial.</span></span>
<span id="cb16-24"><a href="#cb16-24"></a></span>
<span id="cb16-25"><a href="#cb16-25"></a><span class="co">        Returns:</span></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="co">            float: The value of the objective function (RMSE).</span></span>
<span id="cb16-27"><a href="#cb16-27"></a></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="co">        Notes:</span></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="co">            - The objective function samples hyperparameters from the defined search space.</span></span>
<span id="cb16-30"><a href="#cb16-30"></a><span class="co">            - It initializes and trains a RandomForestRegressor model with the sampled hyperparameters.</span></span>
<span id="cb16-31"><a href="#cb16-31"></a><span class="co">            - The model is evaluated on the validation data, and the RMSE is calculated.</span></span>
<span id="cb16-32"><a href="#cb16-32"></a><span class="co">            - The RMSE and the sampled hyperparameters are logged to MLflow.</span></span>
<span id="cb16-33"><a href="#cb16-33"></a><span class="co">        """</span></span>
<span id="cb16-34"><a href="#cb16-34"></a>        params <span class="op">=</span> {</span>
<span id="cb16-35"><a href="#cb16-35"></a>            <span class="st">'n_estimators'</span>: trial.suggest_int(<span class="st">'n_estimators'</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">1</span>),</span>
<span id="cb16-36"><a href="#cb16-36"></a>            <span class="st">'max_depth'</span>: trial.suggest_int(<span class="st">'max_depth'</span>, <span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb16-37"><a href="#cb16-37"></a>            <span class="st">'min_samples_split'</span>: trial.suggest_int(<span class="st">'min_samples_split'</span>, <span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">1</span>),</span>
<span id="cb16-38"><a href="#cb16-38"></a>            <span class="st">'min_samples_leaf'</span>: trial.suggest_int(<span class="st">'min_samples_leaf'</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>),</span>
<span id="cb16-39"><a href="#cb16-39"></a>            <span class="st">'random_state'</span>: <span class="dv">42</span>,</span>
<span id="cb16-40"><a href="#cb16-40"></a>            <span class="st">'n_jobs'</span>: <span class="op">-</span><span class="dv">1</span></span>
<span id="cb16-41"><a href="#cb16-41"></a>        }</span>
<span id="cb16-42"><a href="#cb16-42"></a>        </span>
<span id="cb16-43"><a href="#cb16-43"></a>        <span class="co"># Start a new MLflow run for each trial</span></span>
<span id="cb16-44"><a href="#cb16-44"></a>        <span class="cf">with</span> mlflow.start_run():</span>
<span id="cb16-45"><a href="#cb16-45"></a>            <span class="co"># Set a tag for the model type</span></span>
<span id="cb16-46"><a href="#cb16-46"></a>            mlflow.set_tag(<span class="st">"model"</span>, <span class="st">"RandomForestRegressor"</span>)</span>
<span id="cb16-47"><a href="#cb16-47"></a>            </span>
<span id="cb16-48"><a href="#cb16-48"></a>            <span class="co"># Log the sampled hyperparameters to MLflow</span></span>
<span id="cb16-49"><a href="#cb16-49"></a>            mlflow.log_params(params)</span>
<span id="cb16-50"><a href="#cb16-50"></a></span>
<span id="cb16-51"><a href="#cb16-51"></a>            <span class="co"># Initialize a RandomForestRegressor model with the sampled hyperparameters</span></span>
<span id="cb16-52"><a href="#cb16-52"></a>            rf <span class="op">=</span> RandomForestRegressor(<span class="op">**</span>params)</span>
<span id="cb16-53"><a href="#cb16-53"></a></span>
<span id="cb16-54"><a href="#cb16-54"></a>            <span class="co"># Train the model on the training data</span></span>
<span id="cb16-55"><a href="#cb16-55"></a>            rf.fit(X_train, y_train)</span>
<span id="cb16-56"><a href="#cb16-56"></a></span>
<span id="cb16-57"><a href="#cb16-57"></a>            <span class="co"># Make predictions on the validation data</span></span>
<span id="cb16-58"><a href="#cb16-58"></a>            y_pred <span class="op">=</span> rf.predict(X_val)</span>
<span id="cb16-59"><a href="#cb16-59"></a></span>
<span id="cb16-60"><a href="#cb16-60"></a>            <span class="co"># Calculate the root mean squared error (RMSE)</span></span>
<span id="cb16-61"><a href="#cb16-61"></a>            rmse <span class="op">=</span> mean_squared_error(y_val, y_pred, squared<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-62"><a href="#cb16-62"></a></span>
<span id="cb16-63"><a href="#cb16-63"></a>            <span class="co"># Log the RMSE metric to MLflow</span></span>
<span id="cb16-64"><a href="#cb16-64"></a>            mlflow.log_metric(<span class="st">"rmse"</span>, rmse)</span>
<span id="cb16-65"><a href="#cb16-65"></a></span>
<span id="cb16-66"><a href="#cb16-66"></a>        <span class="cf">return</span> rmse</span>
<span id="cb16-67"><a href="#cb16-67"></a></span>
<span id="cb16-68"><a href="#cb16-68"></a>    <span class="co"># Use the Tree-structured Parzen Estimator (TPE) sampler for efficient hyperparameter search</span></span>
<span id="cb16-69"><a href="#cb16-69"></a>    sampler <span class="op">=</span> TPESampler(seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb16-70"><a href="#cb16-70"></a></span>
<span id="cb16-71"><a href="#cb16-71"></a>    <span class="co"># Create an Optuna study with the defined objective function and search direction</span></span>
<span id="cb16-72"><a href="#cb16-72"></a>    study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, sampler<span class="op">=</span>sampler)</span>
<span id="cb16-73"><a href="#cb16-73"></a></span>
<span id="cb16-74"><a href="#cb16-74"></a>    <span class="co"># Run the optimization process with the specified number of trials</span></span>
<span id="cb16-75"><a href="#cb16-75"></a>    study.optimize(objective, n_trials<span class="op">=</span>num_trials)</span>
<span id="cb16-76"><a href="#cb16-76"></a></span>
<span id="cb16-77"><a href="#cb16-77"></a>run_optimization()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2023-05-26 12:23:03,233] A new study created in memory with name: no-name-19f4f970-eafc-402c-89b3-2aa461ab17fc
[I 2023-05-26 12:23:04,744] Trial 0 finished with value: 6.012747224033297 and parameters: {'n_estimators': 25, 'max_depth': 20, 'min_samples_split': 8, 'min_samples_leaf': 3}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:04,872] Trial 1 finished with value: 6.249433998787504 and parameters: {'n_estimators': 16, 'max_depth': 4, 'min_samples_split': 2, 'min_samples_leaf': 4}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:06,223] Trial 2 finished with value: 6.039045655830305 and parameters: {'n_estimators': 34, 'max_depth': 15, 'min_samples_split': 2, 'min_samples_leaf': 4}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:06,636] Trial 3 finished with value: 6.179387143797025 and parameters: {'n_estimators': 44, 'max_depth': 5, 'min_samples_split': 3, 'min_samples_leaf': 1}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:07,140] Trial 4 finished with value: 6.075505898039151 and parameters: {'n_estimators': 22, 'max_depth': 11, 'min_samples_split': 5, 'min_samples_leaf': 2}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:07,316] Trial 5 finished with value: 6.441117537172997 and parameters: {'n_estimators': 35, 'max_depth': 3, 'min_samples_split': 4, 'min_samples_leaf': 2}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:08,432] Trial 6 finished with value: 6.0285791267371165 and parameters: {'n_estimators': 28, 'max_depth': 16, 'min_samples_split': 3, 'min_samples_leaf': 3}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:08,532] Trial 7 finished with value: 7.881244954282265 and parameters: {'n_estimators': 34, 'max_depth': 1, 'min_samples_split': 7, 'min_samples_leaf': 1}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:09,146] Trial 8 finished with value: 6.025608014492215 and parameters: {'n_estimators': 12, 'max_depth': 19, 'min_samples_split': 10, 'min_samples_leaf': 4}. Best is trial 0 with value: 6.012747224033297.
[I 2023-05-26 12:23:09,239] Trial 9 finished with value: 7.071070856187059 and parameters: {'n_estimators': 22, 'max_depth': 2, 'min_samples_split': 8, 'min_samples_leaf': 2}. Best is trial 0 with value: 6.012747224033297.</code></pre>
</div>
</div>
<p>After running the experiment, you can see the results in the MLflow UI. You can also select multiple runs and compare them using the <code>Compare</code> button on the top left corner of the table.</p>
<p><img src="./images/hyperparameter_rf.png" class="img-fluid"></p>
<p><img src="./images/compare_results.png" class="img-fluid"></p>
<ul>
<li>One of the most interesting plot in the MLflow UI is the <code>Parallel Coordinates Plot</code>. It allows you to visualize the relationship between the hyperparameters and the metrics.</li>
<li><code>Scatter plot</code> allows you to visualize the relationship between a single hyperparameter and the metric.</li>
<li><code>Box Plot</code> are similar to scatter plot in terms of visualization.</li>
<li><code>Contour Plot</code> allows you to visualize the relationship between two hyperparameters and the metric.</li>
</ul>
<p>Apart from the visualizations, they also provide more information of the <code>Run Duration</code>, <code>Parameters</code>, <code>Metrics</code> and <code>Tags</code> associated with the run in a tabular format to compare the runs.</p>
</section>
<section id="model-registry" class="level2">
<h2 class="anchored" data-anchor-id="model-registry">Model Registry</h2>
<p>MLflow Model Registry is a centralized model store, set of APIs, and UI, to collaboratively manage the full lifecycle of an MLflow Model. It provides model lineage (which MLflow Experiment and Run produced the model), model versioning, stage transitions (for example from staging to production), annotations, and other functionality to track the model lifecycle.</p>
<p>From our example above for hyperparameter tuning, we can register the best model which performs well on the test dataset.</p>
<p>To interact with an MLflow Tracking Server and an MLflow Registry Server, we utilize the Client class. It allows us to create and manage experiments and runs in the Tracking Server, as well as create and manage registered models and model versions in the Registry Server. The mlflow.client module offers a Python interface for performing CRUD operations on MLflow Experiments, Runs, Model Versions, and Registered Models. It serves as a lower-level API that directly corresponds to MLflow’s REST API calls.</p>
<p>More information about the MLflow Client can be found <a href="https://mlflow.org/docs/latest/python_api/mlflow.client.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Hyperparameter optimization experiment name</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>HPO_EXPERIMENT_NAME <span class="op">=</span> <span class="st">"random-forest-hyperopt"</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># Best model experiment name</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>EXPERIMENT_NAME <span class="op">=</span> <span class="st">"random-forest-best-models"</span></span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co"># Create a new experiment for the best models</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>mlflow.set_experiment(EXPERIMENT_NAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Automatically log parameters and metrics</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>mlflow.sklearn.autolog()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># RandomForest Parameters</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>RF_PARAMS <span class="op">=</span> [<span class="st">'max_depth'</span>, <span class="st">'n_estimators'</span>, <span class="st">'min_samples_split'</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>             <span class="st">'min_samples_leaf'</span>, <span class="st">'random_state'</span>, <span class="st">'n_jobs'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">def</span> train_and_log_model(params):</span>
<span id="cb21-2"><a href="#cb21-2"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">    Trains a RandomForestRegressor model with the given hyperparameters and logs evaluation metrics to MLflow.</span></span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">    Parameters:</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">        params (dict): Dictionary of hyperparameters for RandomForestRegressor.</span></span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">    Returns:</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">        None</span></span>
<span id="cb21-10"><a href="#cb21-10"></a></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">    Notes:</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">        - The function starts an MLflow run to track the model training and evaluation process.</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">        - It converts certain hyperparameters to integers.</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co">        - A RandomForestRegressor model is initialized with the provided hyperparameters.</span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co">        - The model is trained on the training data.</span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">        - The trained model is evaluated on the validation and test sets, and the root mean squared error (RMSE) is calculated and logged to MLflow as evaluation metrics.</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">    """</span></span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a>    <span class="cf">with</span> mlflow.start_run():</span>
<span id="cb21-20"><a href="#cb21-20"></a>        <span class="co"># Convert specific hyperparameters to integers</span></span>
<span id="cb21-21"><a href="#cb21-21"></a>        <span class="cf">for</span> param <span class="kw">in</span> RF_PARAMS:</span>
<span id="cb21-22"><a href="#cb21-22"></a>            params[param] <span class="op">=</span> <span class="bu">int</span>(params[param])</span>
<span id="cb21-23"><a href="#cb21-23"></a></span>
<span id="cb21-24"><a href="#cb21-24"></a>        <span class="co"># Initialize a RandomForestRegressor model with the given hyperparameters</span></span>
<span id="cb21-25"><a href="#cb21-25"></a>        rf <span class="op">=</span> RandomForestRegressor(<span class="op">**</span>params)</span>
<span id="cb21-26"><a href="#cb21-26"></a></span>
<span id="cb21-27"><a href="#cb21-27"></a>        <span class="co"># Train the model on the training data</span></span>
<span id="cb21-28"><a href="#cb21-28"></a>        rf.fit(X_train, y_train)</span>
<span id="cb21-29"><a href="#cb21-29"></a></span>
<span id="cb21-30"><a href="#cb21-30"></a>        <span class="co"># Evaluate the trained model on the validation set</span></span>
<span id="cb21-31"><a href="#cb21-31"></a>        val_rmse <span class="op">=</span> mean_squared_error(y_val, rf.predict(X_val), squared<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-32"><a href="#cb21-32"></a></span>
<span id="cb21-33"><a href="#cb21-33"></a>        <span class="co"># Log the validation RMSE metric to MLflow</span></span>
<span id="cb21-34"><a href="#cb21-34"></a>        mlflow.log_metric(<span class="st">"val_rmse"</span>, val_rmse)</span>
<span id="cb21-35"><a href="#cb21-35"></a></span>
<span id="cb21-36"><a href="#cb21-36"></a>        <span class="co"># Evaluate the trained model on the test set</span></span>
<span id="cb21-37"><a href="#cb21-37"></a>        test_rmse <span class="op">=</span> mean_squared_error(y_test, rf.predict(X_test), squared<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-38"><a href="#cb21-38"></a></span>
<span id="cb21-39"><a href="#cb21-39"></a>        <span class="co"># Log the test RMSE metric to MLflow</span></span>
<span id="cb21-40"><a href="#cb21-40"></a>        mlflow.log_metric(<span class="st">"test_rmse"</span>, test_rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">def</span> run_register_model(top_n: <span class="bu">int</span>):</span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="co">"""</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">    Runs the process to register the best model based on the top_n model runs with the lowest test RMSE.</span></span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">    Parameters:</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co">        top_n (int): The number of top model runs to consider.</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">    Returns:</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">        None</span></span>
<span id="cb22-10"><a href="#cb22-10"></a></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="co">    Notes:</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="co">        - The function interacts with the MLflow tracking server to retrieve and register models.</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="co">        - It retrieves the top_n model runs based on the lowest validation RMSE.</span></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co">        - For each run, it trains a model using the hyperparameters from the run and logs evaluation metrics to MLflow.</span></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="co">        - After evaluating the models, it selects the one with the lowest test RMSE.</span></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="co">        - The selected model is registered with a specified name in MLflow.</span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co">    """</span></span>
<span id="cb22-18"><a href="#cb22-18"></a></span>
<span id="cb22-19"><a href="#cb22-19"></a>    <span class="co"># Connect to the MLflow tracking server</span></span>
<span id="cb22-20"><a href="#cb22-20"></a>    client <span class="op">=</span> MlflowClient()</span>
<span id="cb22-21"><a href="#cb22-21"></a></span>
<span id="cb22-22"><a href="#cb22-22"></a>    <span class="co"># Retrieve the top_n model runs and log the models</span></span>
<span id="cb22-23"><a href="#cb22-23"></a>    experiment <span class="op">=</span> client.get_experiment_by_name(HPO_EXPERIMENT_NAME)</span>
<span id="cb22-24"><a href="#cb22-24"></a></span>
<span id="cb22-25"><a href="#cb22-25"></a>    <span class="co"># Retrieve the top_n model runs based on the lowest validation RMSE</span></span>
<span id="cb22-26"><a href="#cb22-26"></a>    runs <span class="op">=</span> client.search_runs(</span>
<span id="cb22-27"><a href="#cb22-27"></a>        experiment_ids<span class="op">=</span>experiment.experiment_id,</span>
<span id="cb22-28"><a href="#cb22-28"></a>        run_view_type<span class="op">=</span>ViewType.ACTIVE_ONLY,</span>
<span id="cb22-29"><a href="#cb22-29"></a>        max_results<span class="op">=</span>top_n,</span>
<span id="cb22-30"><a href="#cb22-30"></a>        order_by<span class="op">=</span>[<span class="st">"metrics.rmse ASC"</span>]</span>
<span id="cb22-31"><a href="#cb22-31"></a>    )</span>
<span id="cb22-32"><a href="#cb22-32"></a></span>
<span id="cb22-33"><a href="#cb22-33"></a>    <span class="co"># Train and log the model for each run</span></span>
<span id="cb22-34"><a href="#cb22-34"></a>    <span class="cf">for</span> run <span class="kw">in</span> runs:</span>
<span id="cb22-35"><a href="#cb22-35"></a>        <span class="co"># Train and log the model based on the hyperparameters from the run</span></span>
<span id="cb22-36"><a href="#cb22-36"></a>        train_and_log_model(params<span class="op">=</span>run.data.params)</span>
<span id="cb22-37"><a href="#cb22-37"></a></span>
<span id="cb22-38"><a href="#cb22-38"></a>    <span class="co"># Select the model with the lowest test RMSE</span></span>
<span id="cb22-39"><a href="#cb22-39"></a>    experiment <span class="op">=</span> client.get_experiment_by_name(EXPERIMENT_NAME)</span>
<span id="cb22-40"><a href="#cb22-40"></a></span>
<span id="cb22-41"><a href="#cb22-41"></a>    <span class="co"># Retrieve model runs based on the lowest test RMSE, and select the first run (with the lowest test RMSE)</span></span>
<span id="cb22-42"><a href="#cb22-42"></a>    best_run <span class="op">=</span> client.search_runs(</span>
<span id="cb22-43"><a href="#cb22-43"></a>        experiment_ids<span class="op">=</span>experiment.experiment_id,</span>
<span id="cb22-44"><a href="#cb22-44"></a>        run_view_type<span class="op">=</span>ViewType.ACTIVE_ONLY,</span>
<span id="cb22-45"><a href="#cb22-45"></a>        order_by<span class="op">=</span>[<span class="st">"metrics.test_rmse ASC"</span>]</span>
<span id="cb22-46"><a href="#cb22-46"></a>    )[<span class="dv">0</span>]</span>
<span id="cb22-47"><a href="#cb22-47"></a></span>
<span id="cb22-48"><a href="#cb22-48"></a>    <span class="co"># Register the best model</span></span>
<span id="cb22-49"><a href="#cb22-49"></a>    model_uri <span class="op">=</span> <span class="ss">f"runs:/</span><span class="sc">{</span>best_run<span class="sc">.</span>info<span class="sc">.</span>run_id<span class="sc">}</span><span class="ss">/model"</span></span>
<span id="cb22-50"><a href="#cb22-50"></a></span>
<span id="cb22-51"><a href="#cb22-51"></a>    <span class="co"># Register the best model with a specified name</span></span>
<span id="cb22-52"><a href="#cb22-52"></a>    mlflow.register_model(</span>
<span id="cb22-53"><a href="#cb22-53"></a>        model_uri<span class="op">=</span>model_uri,</span>
<span id="cb22-54"><a href="#cb22-54"></a>        name<span class="op">=</span><span class="st">"random-forest-best-model"</span></span>
<span id="cb22-55"><a href="#cb22-55"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># The number of top model runs to consider</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>top_n <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a>run_register_model(top_n<span class="op">=</span>top_n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2023/05/26 13:27:30 WARNING mlflow.utils.autologging_utils: MLflow autologging encountered a warning: "/Users/wizard/Astronaut/Dev/MLOps/week2/venv/lib/python3.9/site-packages/_distutils_hack/__init__.py:33: UserWarning: Setuptools is replacing distutils."
Successfully registered model 'random-forest-best-model'.
2023/05/26 13:27:40 INFO mlflow.tracking._model_registry.client: Waiting up to 300 seconds for model version to finish creation. Model name: random-forest-best-model, version 1
Created version '1' of model 'random-forest-best-model'.</code></pre>
</div>
</div>
<p>By following the mentioned steps, a new experiment called random-forest-best-models will be created, displaying five runs. You may observe that each run provides additional information. This is due to the utilization of MLflow’s <strong>autologging</strong> feature.</p>
<p>Read more about autologging <a href="https://mlflow.org/docs/latest/tracking.html#automatic-logging">here</a></p>
<p>Autologging captures more parameters, metrics, and tags, and also saves the model as an artifact along with environment details. This feature proves particularly beneficial when you aim to reproduce the results. You have the option to download the model and environment details, enabling you to replicate the outcomes accurately.</p>
<p><img src="./images/rf_test_runs.png" class="img-fluid"></p>
<p>Click on the run with the best model stored and access additional details about the run.</p>
<p><img src="./images/best_test_run.png" class="img-fluid"></p>
<p>By clicking on the link to model registry in the above image, you will be redirected to the model registry page.</p>
<p><img src="./images/best_model.png" class="img-fluid"></p>
<p>Another way to access the model registry is by clicking on the model registry tab on the left side of the MLflow UI. You will be able to see the model registry page with the best model registered.</p>
<p><img src="./images/mlflow_model_section.png" class="img-fluid"></p>
<p>You also have an option to change the stage of the model to <code>Staging</code>, <code>Production</code>, or <code>Archived</code>. You can do this by clicking on the stage transition button on the right side of the model name.</p>
<p>In the MLflow ecosystem, the responsibility of determining which models are ready for production lies with the Data Scientist. Once a model is registered in the model registry, the Deployment Engineer can review important details such as the model’s parameters, size, and performance. Based on this information, they can make informed decisions on moving the model across different stages.</p>
<p>It’s important to note that the model registry itself does not handle the deployment of models. It serves as a centralized repository to list the models that are considered production-ready, with stages acting as labels. To complete the deployment process, it is recommended to complement the model registry with a CI/CD pipeline specifically designed for deploying models. This pipeline would handle the actual deployment process, incorporating the production-ready models identified in the model registry.</p>
<p><img src="./images/change_stage.png" class="img-fluid"></p>
</section>
<section id="mlflow-limitations" class="level2">
<h2 class="anchored" data-anchor-id="mlflow-limitations">MLflow Limitations</h2>
<p>MLflow, while a powerful tool for experiment tracking and model management, has certain limitations to consider.</p>
<ul>
<li><strong>Authentication &amp; Users</strong>: It lacks built-in authentication and user management capabilities, making it less suitable for environments requiring strict access control.</li>
<li><strong>Data versioning</strong>: MLflow does not provide a native solution for data versioning, requiring alternative approaches.</li>
<li><strong>Model/Data Monitoring &amp; Alerting</strong>: Moreover, for model and data monitoring, as well as alerting, other specialized tools may be more appropriate.</li>
</ul>
</section>
<section id="alternatives-to-mlflow" class="level2">
<h2 class="anchored" data-anchor-id="alternatives-to-mlflow">Alternatives to MLflow</h2>
<ul>
<li><a href="https://neptune.ai/">Neptune.ai</a></li>
<li><a href="https://www.comet.com/site/">Comet</a></li>
<li><a href="https://wandb.ai/site">Weights &amp; Biases</a></li>
</ul>
<p>Congratulation 🎉! You have successfully trained ML model and tracked the experiment using MLflow.</p>
<p>Thank you for reading and I hope you found this notebook helpful. Upvote if you liked it, comment if you loved it. Hope to see you guys in the next one. Peace!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/(?:http:|https:)\/\/(www\.)?sagarthacker\.com\/*|javascript\:void\(0\)/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<script src="https://utteranc.es/client.js" repo="sagar118/sagarthacker" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Made with <a href="https://quarto.org/">Quarto</a>, by Sagar Thacker. License: <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a>.</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/sagar118">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/sagar-thacker/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:sagar+site@sagarthacker.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>