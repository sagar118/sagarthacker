<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sagar Thacker">
<meta name="dcterms.date" content="2023-06-16">
<meta name="description" content="A comprehensive guide to deploying Prefect Flows on Prefect Cloud">

<title>Beyond the Dataset - Prefect Cloud Deployment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-17YZDMEKH1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-17YZDMEKH1', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Beyond the Dataset - Prefect Cloud Deployment">
<meta name="twitter:description" content="A comprehensive guide to deploying Prefect Flows on Prefect Cloud">
<meta name="twitter:image" content="https://sagarthacker.com/posts/mlops/images/prefect-cloud/first-steps-ui.png">
<meta name="twitter:creator" content="@sagarthacker118">
<meta name="twitter:site" content="@sagarthacker">
<meta name="twitter:image-height" content="796">
<meta name="twitter:image-width" content="1280">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Beyond the Dataset</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/sagar118" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/sagar-thacker/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:sagar+site@sagarthacker.com" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Prefect Cloud Deployment</h1>
                  <div>
        <div class="description">
          A comprehensive guide to deploying Prefect Flows on Prefect Cloud
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">MLOps</div>
                <div class="quarto-category">Prefect</div>
                <div class="quarto-category">Deployment</div>
                <div class="quarto-category">Prefect-Cloud</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sagar Thacker </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 16, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#deployment-on-prefect-cloud" id="toc-deployment-on-prefect-cloud" class="nav-link active" data-scroll-target="#deployment-on-prefect-cloud">Deployment on Prefect Cloud</a>
  <ul class="collapse">
  <li><a href="#step-1-create-a-github-repo" id="toc-step-1-create-a-github-repo" class="nav-link" data-scroll-target="#step-1-create-a-github-repo">Step 1: Create a GitHub repo</a></li>
  <li><a href="#step-2-setup" id="toc-step-2-setup" class="nav-link" data-scroll-target="#step-2-setup">Step 2: Setup</a></li>
  <li><a href="#step-3-create-a-prefect-project" id="toc-step-3-create-a-prefect-project" class="nav-link" data-scroll-target="#step-3-create-a-prefect-project">Step 3: Create a prefect project</a></li>
  <li><a href="#step-3-write-a-prefect-flow-configure-the-yaml-file-and-push-it-to-github" id="toc-step-3-write-a-prefect-flow-configure-the-yaml-file-and-push-it-to-github" class="nav-link" data-scroll-target="#step-3-write-a-prefect-flow-configure-the-yaml-file-and-push-it-to-github">Step 3: Write a prefect flow, configure the yaml file, and push it to GitHub</a></li>
  <li><a href="#step-4-log-into-prefect-cloud-through-cli" id="toc-step-4-log-into-prefect-cloud-through-cli" class="nav-link" data-scroll-target="#step-4-log-into-prefect-cloud-through-cli">Step 4: Log into Prefect Cloud through CLI</a></li>
  <li><a href="#step-5-deploy-the-flow-to-prefect-cloud" id="toc-step-5-deploy-the-flow-to-prefect-cloud" class="nav-link" data-scroll-target="#step-5-deploy-the-flow-to-prefect-cloud">Step 5: Deploy the flow to Prefect Cloud</a></li>
  <li><a href="#step-6-run-the-deployed-flow" id="toc-step-6-run-the-deployed-flow" class="nav-link" data-scroll-target="#step-6-run-the-deployed-flow">Step 6: Run the deployed flow</a></li>
  </ul></li>
  <li><a href="#run-the-deployment-with-mlflow-optional" id="toc-run-the-deployment-with-mlflow-optional" class="nav-link" data-scroll-target="#run-the-deployment-with-mlflow-optional">Run the deployment with mlflow [Optional]</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Prefect Cloud is a hosted platform for managing your data workflows. That means you don’t have to own your own servers. We know Prefect follows a hybrid approach, which means the storage of your flow and the execution environment (prefect server) are seperate from each other.</p>
<p>Why should this matter to you? Simply, it means you can run your code on your own infrastructure keeping the code and data on your own servers. Only the metadata about the run is sent to Prefect Cloud. This is a great way to keep your data secure.</p>
<p>To understand this better, let’s look at it with an example. We’ll follow through the following steps:</p>
<ol type="1">
<li>Create a GitHub repo.</li>
<li>Create a prefect project.</li>
<li>Write a prefect flow, configure the yaml file, and push it to GitHub.</li>
<li>Log into Prefect Cloud through CLI.</li>
<li>Deploy the flow to Prefect Cloud.</li>
<li>Create a worker and run the flow.</li>
<li>[Optional] Run a mlflow experiment.</li>
</ol>
<p>In our example, we’ll store our code on GitHub and use the Prefect Cloud to record your runs. We’ll start the prefect worker locally and run the flow locally.</p>
<p>Everytime you run the deployed flow, the worker will clone the github repo and use the code to run the flow. All the metadata about the run will be sent to Prefect Cloud.</p>
<p>Let’s get started!</p>
<section id="deployment-on-prefect-cloud" class="level2">
<h2 class="anchored" data-anchor-id="deployment-on-prefect-cloud">Deployment on Prefect Cloud</h2>
<section id="step-1-create-a-github-repo" class="level3">
<h3 class="anchored" data-anchor-id="step-1-create-a-github-repo">Step 1: Create a GitHub repo</h3>
<p>Login to your GitHub account and create a new repository. Name it <code>prefect-cloud-demo</code> for instance.</p>
<p>Locally, initialize a git repo and add the remote origin to your local repo.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Initialize a git repo</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">git</span> init</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># Add the remote origin to your local repo</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">git</span> remote add origin <span class="pp">[</span><span class="ss">your</span><span class="pp">-</span><span class="ss">github</span><span class="pp">-</span><span class="ss">repo</span><span class="pp">-</span><span class="ss">url</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-setup" class="level3">
<h3 class="anchored" data-anchor-id="step-2-setup">Step 2: Setup</h3>
<p>It is a good practice to create a virtual environment for each project. This helps us keep our dependencies separate and avoid any version conflicts.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="va">fastparquet</span><span class="op">=</span>=2023.4.0</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="va">mlflow</span><span class="op">=</span>=2.3.1</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="va">pandas</span><span class="op">=</span>=2.0.1</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="va">prefect</span><span class="op">=</span>=2.10.8</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="va">scikit_learn</span><span class="op">=</span>=1.2.2</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="va">xgboost</span><span class="op">=</span>=1.7.5</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="ex">psycopg2-binary==2.9.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s create a virtual environment named <code>venv</code> and install all the dependencies.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create a virtual environment</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="ex">conda</span> create <span class="at">-p</span> venv python=3.10 <span class="at">-y</span></span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Activate the virtual environment</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="ex">conda</span> activate venv/</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Install all the dependencies</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt <span class="at">--no-cache-dir</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-create-a-prefect-project" class="level3">
<h3 class="anchored" data-anchor-id="step-3-create-a-prefect-project">Step 3: Create a prefect project</h3>
<p>Create a prefect project using the CLI.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">prefect</span> project init</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The folder structure of your project should look like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">.</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="ex">├──</span> deployment.yaml</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="ex">├──</span> prefect.yaml</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="ex">├──</span> requirements.txt</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="ex">└──</span> venv</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="ex">└──</span> ./prefect <span class="er">(</span><span class="ex">hidden</span><span class="kw">)</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="ex">└──</span> .prefectignore <span class="er">(</span><span class="ex">hidden</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>One thing to note here is that in the <code>prefect.yaml</code> file you’ll see key named <code>pull</code> with a value for <code>git_clone_project</code>. It will contain the url of your GitHub repo. It automatically gets added when you run the <code>prefect project init</code> command in a git repo.</p>
<p>Everytime you run a deployment flow it will pull the code from the repo to run it.</p>
</div>
</div>
</section>
<section id="step-3-write-a-prefect-flow-configure-the-yaml-file-and-push-it-to-github" class="level3">
<h3 class="anchored" data-anchor-id="step-3-write-a-prefect-flow-configure-the-yaml-file-and-push-it-to-github">Step 3: Write a prefect flow, configure the yaml file, and push it to GitHub</h3>
<p>We’ll use the same flow we created in the previous section to keep things simple.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>"prefect_demo.py</strong></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">from</span> prefect <span class="im">import</span> flow, task</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="at">@task</span>(name<span class="op">=</span><span class="st">"say_hello"</span>, log_prints<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">def</span> say_hello():</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="bu">print</span>(<span class="st">"Hello, I'm a Task!"</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="at">@flow</span>(name<span class="op">=</span><span class="st">"mlflow-flow"</span>, log_prints<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="kw">def</span> flow_hello():</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="bu">print</span>(<span class="st">"Hello, I'm a Flow!"</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="bu">print</span>(<span class="st">"I'm about to call a Task..."</span>)</span>
<span id="cb6-11"><a href="#cb6-11"></a>    say_hello()</span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb6-14"><a href="#cb6-14"></a>    flow_hello()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now configure the <code>deployment.yaml</code> file. This file tells Prefect Cloud how to deploy your flow.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>deployment.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">deployments</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">-</span><span class="co"> # base metadata</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> manual-deployment</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="at">  </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"test"</span><span class="kw">]</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="at">  </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Trigger deployment using `run` CLI command or Prefect UI"</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="at">  </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">  # flow-specific fields</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="at">  </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> prefect_demo.py:flow_hello</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="at">  </span><span class="fu">parameters</span><span class="kw">:</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Sagar"</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="at">  </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">  # infra-specific fields</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="at">  </span><span class="fu">work_pool</span><span class="kw">:</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> test-pool</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="at">    </span><span class="fu">work_queue_name</span><span class="kw">:</span><span class="at"> demo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now push the code to GitHub.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Add all the files to git</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">git</span> add .</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Add .gitignore</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">touch</span> .gitignore</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># Add the following to .gitignore file from https://github.com/github/gitignore/blob/main/Python.gitignore</span></span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co"># Commit the changes</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Initial commit"</span></span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co"># Push the code to GitHub</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="fu">git</span> push <span class="at">-u</span> origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-log-into-prefect-cloud-through-cli" class="level3">
<h3 class="anchored" data-anchor-id="step-4-log-into-prefect-cloud-through-cli">Step 4: Log into Prefect Cloud through CLI</h3>
<p>If you haven’t already created an account on Prefect Cloud, you can do so <a href="https://app.prefect.cloud/auth/login">here</a>. Enter your email and you’ll receive a link to login to Prefect Cloud.</p>
<p>Now, we’ll create a workspace in Prefect Cloud. Workspaces are only available on prefect cloud. Workspaces offer the flexibility to organize and compartmentalize your workflows according to your preferences.</p>
<p>For instance, you can leverage separate workspaces to isolate development, staging, and production environments. They also provide a means to create clear boundaries between different teams, ensuring better organization and collaboration.</p>
<p>Create a workspace named <code>demo</code>.</p>
<p>Let’s go ahead and login to Prefect Cloud through CLI. Run the following command to see that which server you’re connected to by default.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">prefect</span> version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Under the Server section, you’ll notice Database as sqlite and SQLite version mentioned. This means when you run the flow, it will create a sqlite database on your local machine and store the metadata there.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="ex">Version:</span>             2.10.8</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="ex">API</span> version:         0.8.4</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="ex">Python</span> version:      3.10.11</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="ex">Git</span> commit:          79093235</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="ex">Built:</span>               Mon, May 8, 2023 12:23 PM</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="ex">OS/Arch:</span>             darwin/x86_64</span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="ex">Profile:</span>             default</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="ex">Server</span> type:         ephemeral</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="ex">Server:</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="ex">Database:</span>          sqlite</span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="ex">SQLite</span> version:    3.41.2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s now login to Prefect Cloud through CLI. Run the following command</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="ex">prefect</span> cloud login</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and you’ll be presented with two options:</p>
<ol type="1">
<li>Log in with a web browser.</li>
<li>Paste an API key.</li>
</ol>
<p>Let’s go ahead and login with a web browser. By default, option 1 will be highlighted and you can press enter to continue. This will open a browser window and you’ll be asked to authorize.</p>
<p>Once you’ve authorized, you’ll see a message like <code>Authenticated with Prefect Cloud! Using workspace '[email]/demo'</code>.</p>
<p>Now if you run <code>prefect version</code>, you’ll see that the server has changed to <code>cloud</code>. This means that when you run the flow, it will upload the metadata to Prefect Cloud.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="ex">Version:</span>             2.10.8</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="ex">API</span> version:         0.8.4</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="ex">Python</span> version:      3.10.11</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="ex">Git</span> commit:          79093235</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="ex">Built:</span>               Mon, May 8, 2023 12:23 PM</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="ex">OS/Arch:</span>             darwin/x86_64</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="ex">Profile:</span>             default</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="ex">Server</span> type:         cloud</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-deploy-the-flow-to-prefect-cloud" class="level3">
<h3 class="anchored" data-anchor-id="step-5-deploy-the-flow-to-prefect-cloud">Step 5: Deploy the flow to Prefect Cloud</h3>
<p>Before we deploy the flow, let’s create a work pool. Follow the steps below:</p>
<ol type="1">
<li>Go to the <code>Work Pools</code> tab on the left side of the screen.</li>
<li>Click on the<code>+</code> icon on the top middle of the screen.</li>
<li>Enter the name of the work pool as <code>test-pool</code>.</li>
<li>Select the <code>Local Subprocess</code> as the Infrastructure Type.</li>
<li>Click on the <code>Create</code> button.</li>
</ol>
<p>Now, let’s deploy the flow to Prefect Cloud. Run the following command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="ex">prefect</span> deploy <span class="at">--name</span> manual-deployment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-6-run-the-deployed-flow" class="level3">
<h3 class="anchored" data-anchor-id="step-6-run-the-deployed-flow">Step 6: Run the deployed flow</h3>
<p>To run the deployed flow, we need a <code>worker</code> that will run the flow. Run the following command to start a worker:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a><span class="ex">prefect</span> worker start <span class="at">-p</span> test-pool</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open a new terminal to run the flow. Now we have two options to run the deployed flow:</p>
<ol type="1">
<li>Through CLI</li>
<li>Through Prefect UI</li>
</ol>
<p>Previously I have mostly used the Prefect UI to run the flow. But in this case, we’ll use the CLI to run the flow. Run the following command to run the flow:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Command to run the flow</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="ex">prefect</span> deployment run <span class="pp">[</span><span class="ss">DEPLOYMENT</span><span class="pp">-</span><span class="ss">NAME</span><span class="pp">]</span></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># In our case, the command will be</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="ex">prefect</span> deployment run  hello-flow/manual-deployment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you don’t know the name of the deployment, you can run the following command to see all the deployments:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="ex">prefect</span> deployment ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Congratulations 🎉🎉🎉! You’ve successfully deployed and run your first flow on Prefect Cloud.</p>
<p>Prefect gives you the flexibility to store your code anywhere and run it anywhere. You can start the worker on local, EC2, or any other machine and run the flow.</p>
<p>Now, let’s see how to run the deployment with mlflow to record the metrics.</p>
</section>
</section>
<section id="run-the-deployment-with-mlflow-optional" class="level2">
<h2 class="anchored" data-anchor-id="run-the-deployment-with-mlflow-optional">Run the deployment with mlflow [Optional]</h2>
<p>We’ll tweak the flow a little bit to record the metrics with mlflow. The code is super super simple, however, the main take away is how to set the tracking uri and start the mlflow server to track the metrics.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>mlflow_demo.py</strong></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">import</span> mlflow</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="im">from</span> prefect <span class="im">import</span> flow, task</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="at">@task</span>(name<span class="op">=</span><span class="st">"mlflow-run"</span>, log_prints<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="kw">def</span> mlflow_run():</span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="cf">with</span> mlflow.start_run():</span>
<span id="cb17-7"><a href="#cb17-7"></a>    mlflow.log_metric(<span class="st">"metric"</span>, <span class="fl">1.0</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="at">@flow</span>(name<span class="op">=</span><span class="st">"mlflow-flow"</span>, log_prints<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="kw">def</span> flow_hello():</span>
<span id="cb17-11"><a href="#cb17-11"></a>    mlflow.set_tracking_uri(<span class="st">"http://127.0.0.1:5000"</span>)</span>
<span id="cb17-12"><a href="#cb17-12"></a>    mlflow.set_experiment(<span class="st">"demo"</span>)</span>
<span id="cb17-13"><a href="#cb17-13"></a>    </span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="bu">print</span>(<span class="st">"Hello, I'm a Flow!"</span>)</span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="bu">print</span>(<span class="st">"I'm about to call a Task..."</span>)</span>
<span id="cb17-16"><a href="#cb17-16"></a>    mlflow_run()</span>
<span id="cb17-17"><a href="#cb17-17"></a></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb17-19"><a href="#cb17-19"></a>    flow_hello()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now configure the <code>deployment.yaml</code> file. Add the following lines to the <code>deployment.yaml</code> file.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>deployment.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">-</span><span class="co"> # base metadata</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> mlflow-deployment</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="at">  </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Trigger deployment using `run` CLI command or Prefect UI"</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="at">  </span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">  # flow-specific fields</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="at">  </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> mlflow_demo.py:flow_hello</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="at">  </span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">  # infra-specific fields</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="at">  </span><span class="fu">work_pool</span><span class="kw">:</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> test-pool</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="at">    </span><span class="fu">work_queue_name</span><span class="kw">:</span><span class="at"> mlflow-demo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now push the code to GitHub.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Add all the files to git</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">git</span> add .</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># Commit the changes</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Add mlflow demo"</span></span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># Push the code to GitHub</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="fu">git</span> push <span class="at">-u</span> origin main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we’ll deploy the new flow to Prefect Cloud. Run the following command:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Deploy the flow</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="ex">prefect</span> deploy <span class="at">--name</span> mlflow-deployment</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># Checkout the deployment name</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="ex">prefect</span> deployment ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We already have a worker running. However, if you don’t have a worker running, you can start a worker by running the following command:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1"></a><span class="ex">prefect</span> worker start <span class="at">-p</span> test-pool</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s start the mlflow server. Run the following command:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"></a><span class="ex">mlflow</span> server <span class="at">--backend-store-uri</span> sqlite:///mlflow.db <span class="at">--default-artifact-root</span> ./artifacts <span class="at">--host</span> 127.0.0.1 <span class="at">--port</span> 5000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, let’s run the flow. Run the following command:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"></a><span class="ex">prefect</span> deployment run mlflow-flow/mlflow-deployment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Some pointer to note:</p>
<ul>
<li>We set the tracking uri and experiment name in the function where the flow begins.
<ul>
<li>This is important because if you set the tracking uri and experiment name in the <code>__main__</code> function, it will not work.</li>
<li>When you run the flow, it runs the function where the flow begins.</li>
<li>In our case, it’s the <code>flow_hello</code> function.</li>
</ul></li>
<li>We set the tracking uri to <code>http://127.0.0.1:5000</code> because we ran the server locally, however if you run the server on EC2 or any other machine, you need to set the tracking uri accordingly.</li>
<li>To start the mlflow server we used the backend store as <code>sqlite db</code> and <code>artifacts</code> directory to store the artifacts.</li>
<li>We also specified the host and post so as to map the mlflow server to the same port where we set the tracking uri.</li>
</ul>
<p>Lastly, if you want to logout from the Prefect Cloud, run the following command:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1"></a><span class="ex">prefect</span> cloud logout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://docs.prefect.io/cloud/">Prefect Cloud Docs</a></li>
<li><a href="https://github.com/PrefectHQ/prefect/blob/main/docs/img/tutorial/first-steps-ui.png">Image Source</a></li>
</ul>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this article, we learned how to deploy a flow to Prefect Cloud and run it. We also learned how to run the flow with mlflow to record the metrics.</p>
<p>I hope you enjoyed this article. If you have any questions, feel free to reach out to me on <a href="https://twitter.com/sagarthacker118">Twitter</a> or <a href="mailto:sagar+site@sagarthacker.com">Email</a>.</p>
<p>👏 Upvote if you liked it, 💬 comment if you loved it. Hope to see you guys in the next one. ✌️ Peace!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("(?:http:|https:)\/\/(www\.)?sagarthacker\.com\/*|javascript\:void\(0\)");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<script src="https://giscus.app/client.js" data-repo="sagar118/sagarthacker" data-repo-id="R_kgDOIPm5_Q" data-category="General" data-category-id="DIC_kwDOIPm5_c4CXlxO" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Made with <a href="https://quarto.org/">Quarto</a>, by Sagar Thacker. License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/sagar118">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/sagar-thacker/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:sagar+site@sagarthacker.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>